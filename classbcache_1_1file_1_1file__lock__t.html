<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BuildCache: bcache::file::file_lock_t Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BuildCache
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacebcache.html">bcache</a></li><li class="navelem"><a class="el" href="namespacebcache_1_1file.html">file</a></li><li class="navelem"><a class="el" href="classbcache_1_1file_1_1file__lock__t.html">file_lock_t</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-types">Private Types</a> &#124;
<a href="#pri-static-methods">Static Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classbcache_1_1file_1_1file__lock__t-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">bcache::file::file_lock_t Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>A scoped exclusive global lock class.  
 <a href="classbcache_1_1file_1_1file__lock__t.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="file__lock_8hpp_source.html">file_lock.hpp</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ad463d17289b4f5e05c27f11776f01928"><td class="memItemLeft" align="right" valign="top"><a id="ad463d17289b4f5e05c27f11776f01928"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classbcache_1_1file_1_1file__lock__t.html#ad463d17289b4f5e05c27f11776f01928">file_lock_t</a> ()</td></tr>
<tr class="memdesc:ad463d17289b4f5e05c27f11776f01928"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create an empty (unlocked) lock object. <br /></td></tr>
<tr class="separator:ad463d17289b4f5e05c27f11776f01928"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5477dce062a35c55af274c3051097df9"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classbcache_1_1file_1_1file__lock__t.html#a5477dce062a35c55af274c3051097df9">file_lock_t</a> (const std::string &amp;path, const bool remote_lock)</td></tr>
<tr class="memdesc:a5477dce062a35c55af274c3051097df9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Acquire a lock for the specified file path.  <a href="classbcache_1_1file_1_1file__lock__t.html#a5477dce062a35c55af274c3051097df9">More...</a><br /></td></tr>
<tr class="separator:a5477dce062a35c55af274c3051097df9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1771695b7c8f336529a288a0102bd489"><td class="memItemLeft" align="right" valign="top"><a id="a1771695b7c8f336529a288a0102bd489"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>file_lock_t</b> (<a class="el" href="classbcache_1_1file_1_1file__lock__t.html">file_lock_t</a> &amp;&amp;other) noexcept</td></tr>
<tr class="separator:a1771695b7c8f336529a288a0102bd489"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af36fbae9850d2056f4568f7f7030c3bf"><td class="memItemLeft" align="right" valign="top"><a id="af36fbae9850d2056f4568f7f7030c3bf"></a>
<a class="el" href="classbcache_1_1file_1_1file__lock__t.html">file_lock_t</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><b>operator=</b> (<a class="el" href="classbcache_1_1file_1_1file__lock__t.html">file_lock_t</a> &amp;&amp;other) noexcept</td></tr>
<tr class="separator:af36fbae9850d2056f4568f7f7030c3bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a833d8e2de7c79305883b633bf62c02a5"><td class="memItemLeft" align="right" valign="top"><a id="a833d8e2de7c79305883b633bf62c02a5"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>file_lock_t</b> (const <a class="el" href="classbcache_1_1file_1_1file__lock__t.html">file_lock_t</a> &amp;other)=delete</td></tr>
<tr class="separator:a833d8e2de7c79305883b633bf62c02a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace6f4fc5591dc9ce1a1057eda5073599"><td class="memItemLeft" align="right" valign="top"><a id="ace6f4fc5591dc9ce1a1057eda5073599"></a>
<a class="el" href="classbcache_1_1file_1_1file__lock__t.html">file_lock_t</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><b>operator=</b> (const <a class="el" href="classbcache_1_1file_1_1file__lock__t.html">file_lock_t</a> &amp;other)=delete</td></tr>
<tr class="separator:ace6f4fc5591dc9ce1a1057eda5073599"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8350a64fc9784dc0cc3d602e1ba29643"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classbcache_1_1file_1_1file__lock__t.html#a8350a64fc9784dc0cc3d602e1ba29643">~file_lock_t</a> ()</td></tr>
<tr class="memdesc:a8350a64fc9784dc0cc3d602e1ba29643"><td class="mdescLeft">&#160;</td><td class="mdescRight">Release the lock.  <a href="classbcache_1_1file_1_1file__lock__t.html#a8350a64fc9784dc0cc3d602e1ba29643">More...</a><br /></td></tr>
<tr class="separator:a8350a64fc9784dc0cc3d602e1ba29643"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acec45dd643662afd214f10313b010a93"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classbcache_1_1file_1_1file__lock__t.html#acec45dd643662afd214f10313b010a93">has_lock</a> () const</td></tr>
<tr class="separator:acec45dd643662afd214f10313b010a93"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-types"></a>
Private Types</h2></td></tr>
<tr class="memitem:a4f282815e896cb9b81115c294fab2141"><td class="memItemLeft" align="right" valign="top"><a id="a4f282815e896cb9b81115c294fab2141"></a>
using&#160;</td><td class="memItemRight" valign="bottom"><b>file_handle_t</b> = int</td></tr>
<tr class="separator:a4f282815e896cb9b81115c294fab2141"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5d7dd878b75dd0dc388036e853dec296"><td class="memItemLeft" align="right" valign="top"><a id="a5d7dd878b75dd0dc388036e853dec296"></a>
using&#160;</td><td class="memItemRight" valign="bottom"><b>mutex_handle_t</b> = void *</td></tr>
<tr class="separator:a5d7dd878b75dd0dc388036e853dec296"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-static-methods"></a>
Static Private Member Functions</h2></td></tr>
<tr class="memitem:a3de3e0affdca415b74d761f936ba9ce8"><td class="memItemLeft" align="right" valign="top"><a id="a3de3e0affdca415b74d761f936ba9ce8"></a>
static file_handle_t&#160;</td><td class="memItemRight" valign="bottom"><b>invalid_file_handle</b> ()</td></tr>
<tr class="separator:a3de3e0affdca415b74d761f936ba9ce8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a613ed881f9de30cd3341883b74321e24"><td class="memItemLeft" align="right" valign="top"><a id="a613ed881f9de30cd3341883b74321e24"></a>
static mutex_handle_t&#160;</td><td class="memItemRight" valign="bottom"><b>invalid_mutex_handle</b> ()</td></tr>
<tr class="separator:a613ed881f9de30cd3341883b74321e24"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a9ec729ab09e1eb891d8c3e91f33dccf6"><td class="memItemLeft" align="right" valign="top"><a id="a9ec729ab09e1eb891d8c3e91f33dccf6"></a>
std::string&#160;</td><td class="memItemRight" valign="bottom"><b>m_path</b></td></tr>
<tr class="separator:a9ec729ab09e1eb891d8c3e91f33dccf6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a986d5891a21c84e91501beccbee8e2bf"><td class="memItemLeft" align="right" valign="top"><a id="a986d5891a21c84e91501beccbee8e2bf"></a>
file_handle_t&#160;</td><td class="memItemRight" valign="bottom"><b>m_file_handle</b> = invalid_file_handle()</td></tr>
<tr class="separator:a986d5891a21c84e91501beccbee8e2bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a333b7449373630da4503b7a36aff57fa"><td class="memItemLeft" align="right" valign="top"><a id="a333b7449373630da4503b7a36aff57fa"></a>
mutex_handle_t&#160;</td><td class="memItemRight" valign="bottom"><b>m_mutex_handle</b> = invalid_mutex_handle()</td></tr>
<tr class="separator:a333b7449373630da4503b7a36aff57fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade0e39b7bcfd3b82a8a843a70134781a"><td class="memItemLeft" align="right" valign="top"><a id="ade0e39b7bcfd3b82a8a843a70134781a"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>m_has_lock</b> = false</td></tr>
<tr class="separator:ade0e39b7bcfd3b82a8a843a70134781a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>A scoped exclusive global lock class. </p>
<p>This lock class is intended to be used for granular synchronization of multiple processes that need to access a specific part of a file system, such as a single file or a folder. Locks are expected to be held for a very short time period (typically only for a fraction of a second), during operations such as file renames or writes.</p>
<p>When the lock is created, a global named system object is created (if necessary) and acquired. Once the lock goes out of scope, the system object is released. If this is the last process that releases the lock, the system object is deleted.</p>
<p>Two system object types are supported:</p>
<dl class="section user"><dt>Remote locks</dt><dd>A remote lock is implemented as a lock file that will safely synchronize access to any file system, even a remote network share.</dd></dl>
<dl class="section user"><dt>Local locks</dt><dd>A local lock may be implemented as a system synchronization object (e.g. a named mutex or semaphore), that is only guaranteed to be safe for synchronizing file system access on a local system.</dd></dl>
<dl class="section user"><dt></dt><dd>The advantage of a local lock is that on some systems it is faster than a remote lock.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>Do not mix the use of remote locks and local locks for synchronizing access to a single file system, since the locks may live in different namespaces and thus are unaware of each other.</dd>
<dd>
On some systems, local locks are implemented as remote locks. </dd></dl>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a5477dce062a35c55af274c3051097df9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5477dce062a35c55af274c3051097df9">&#9670;&nbsp;</a></span>file_lock_t()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bcache::file::file_lock_t::file_lock_t </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>remote_lock</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Acquire a lock for the specified file path. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">path</td><td>The full path to the lock file (will be created). The path should be a location on the file system to which the process requires access synchronization. </td></tr>
    <tr><td class="paramname">remote_lock</td><td>Require the implementation to use a locking mechanism that can synchronize file system access across several OS instances (e.g. use this for network shares). </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a8350a64fc9784dc0cc3d602e1ba29643"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8350a64fc9784dc0cc3d602e1ba29643">&#9670;&nbsp;</a></span>~file_lock_t()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bcache::file::file_lock_t::~file_lock_t </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Release the lock. </p>
<p>This releases the lock that was held. The sycnhronization object (if any) is deleted if this is the last process that holds a lock. </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="acec45dd643662afd214f10313b010a93"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acec45dd643662afd214f10313b010a93">&#9670;&nbsp;</a></span>has_lock()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool bcache::file::file_lock_t::has_lock </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="section return"><dt>Returns</dt><dd>true if the lock was acquired successfully. </dd></dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>base/<a class="el" href="file__lock_8hpp_source.html">file_lock.hpp</a></li>
<li>base/file_lock.cpp</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
